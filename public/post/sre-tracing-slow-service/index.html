<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Tracing d·ªãch v·ª• b·ªã ch·∫≠m tr√™n m√¥i tr∆∞·ªùng Kubernetes Production | My 0x51 blog</title>
<meta name="keywords" content="k8s, Containerd, Cgroups, tracing, s·ª± c·ªë, SRE">
<meta name="description" content="Nh√©t l·∫°i b·ªô b√†i trong h·ªôc t·ªß v√†o t√∫i ƒëeo ch√©o (h·ªìi c√≤n ·ªü cty t√¥i hay l√≤e m·∫•y ƒë·ª©a b·∫±ng m·∫•y c√°i tricks b√†i l·ªè l·ªèd ), g·∫•p l·∫°i quy·ªÉn s·ªï tay ƒë√£ 5 nƒÉm n·∫±m tr√™n c√°i b·ªô m√°y t√≠nh t·ª´ h·ªìi t√¥i v√†o c√¥ng ty. M·∫•y c√¢u ch√†o t·∫°m bi·ªát v·ªõi anh em, c√°i b·∫Øt tay v·ªôi v√£ v·ªõi s·∫øp ngo√†i h√†nh lang v·∫Øng ng∆∞·ªùi, √°nh m·∫Øt h∆°i ƒë·ªè, nh∆∞ng c≈©ng ƒë·∫øn l√∫c ph·∫£i r·ªùi kh·ªèi c√°i ‚Äúsafe zone‚Äù ·∫•y r·ªìi.">
<meta name="author" content="">
<link rel="canonical" href="//localhost:1313/post/sre-tracing-slow-service/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="//localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="//localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="//localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="//localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="//localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="//localhost:1313/post/sre-tracing-slow-service/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="//localhost:1313/" accesskey="h" title="My 0x51 blog (Alt + H)">My 0x51 blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="//localhost:1313/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Tracing d·ªãch v·ª• b·ªã ch·∫≠m tr√™n m√¥i tr∆∞·ªùng Kubernetes Production
    </h1>
    <div class="post-meta"><span title='2025-02-18 23:41:42 +0700 +07'>February 18, 2025</span>&nbsp;¬∑&nbsp;14 min

</div>
  </header> 
  <div class="post-content"><p>Nh√©t l·∫°i b·ªô b√†i trong h·ªôc t·ªß v√†o t√∫i ƒëeo ch√©o (h·ªìi c√≤n ·ªü cty t√¥i hay l√≤e m·∫•y ƒë·ª©a b·∫±ng m·∫•y c√°i tricks b√†i l·ªè l·ªèd ), g·∫•p l·∫°i quy·ªÉn s·ªï tay ƒë√£ 5 nƒÉm n·∫±m tr√™n c√°i b·ªô m√°y t√≠nh t·ª´ h·ªìi t√¥i v√†o c√¥ng ty. M·∫•y c√¢u ch√†o t·∫°m bi·ªát v·ªõi anh em, c√°i b·∫Øt tay v·ªôi v√£ v·ªõi s·∫øp ngo√†i h√†nh lang v·∫Øng ng∆∞·ªùi, √°nh m·∫Øt h∆°i ƒë·ªè, nh∆∞ng c≈©ng ƒë·∫øn l√∫c ph·∫£i r·ªùi kh·ªèi c√°i ‚Äúsafe zone‚Äù ·∫•y r·ªìi.
ƒê√£ kh√° l√¢u k·ªÉ t·ª´ ng√†y m√† t√¥i quy·∫øt ƒë·ªãnh chuy·ªÉn sang 1 n∆°i l√†m vi·ªác kh√°c, ƒë√¥i khi nh·ªõ l·∫°i, c≈©ng th·∫•y c√≥ v√†i th·ª© hay ho m√† t√¥i ƒë√£ l√†m ƒë∆∞·ª£c. √Çu c≈©ng l√† ch√∫t may m·∫Øn c·ªßa b·∫£n th√¢n khi ƒë∆∞·ª£c l√†m vi·ªác tr·ª±c ti·∫øp vs qu·∫£n l√Ω c≈©ng ch√≠nh l√† CTO c·ªßa 1 cty Product l·ªõn v√† l√¢u ƒë·ªùi ·ªü VN n√†y. H√¥m nay,  t√¨nh c·ªù xem l·∫°i v√†i c√°i note x·ª≠ l√Ω s·ª± c·ªë, t√¥i quy·∫øt ƒë·ªãnh ghi l·∫°i m·ªôt ch√∫t h·ªìi t∆∞·ªüng v·ªÅ nh·ªØng g√¨ ƒë√£ tr·∫£i qua. Bi·∫øt ƒë√¢u, n√≥ s·∫Ω l√† c·∫£m h·ª©ng, hay l√† ki·∫øn th·ª©c cho ch√≠nh m√¨nh sau n√†y th√¨ sao.</p>
<p>B·∫Øt ƒë·∫ßu th√¥i nh·ªâ &hellip;</p>
<p>H·ªìi ƒë√≥, khi c√≤n l√†m SRE t·∫°i c√¥ng ty c≈©, v√†o m·ªôt ng√†y kh√¥ng ƒë·∫πp tr·ªùi l·∫Øm ƒë·ªôi AI (ng·ªìi ngay d√£y b√†n b√™n c·∫°nh) g·ª≠i ƒë·∫øn cho t√¥i m·ªôt request: &quot; Anh Q xem gi√∫p e x·ª≠ l√Ω m·ªôt s·ªë d·ªãch v·ª• trong d·ª± √°n AI b·ªã ch·∫≠m h∆°n khi s·ª≠ d·ª•ng tr√™n m√¥i tr∆∞·ªùng Production v·ªõi üò¢&quot;. ƒêi·ªÉm k·ª≥ l·∫° l√† kh√¥ng c√≥ l·ªói hay exception n√†o xu·∫•t hi·ªán, v√† ƒëi·ªÅu n√†y khi·∫øn m·ªçi th·ª© c√†ng th√™m kh√≥ hi·ªÉu m·∫∑c d√π ƒë√£ ƒë∆∞a d·ªãch v·ª• ra c√°c worker d√πng ri√™ng c·ªßa d·ª± √°n. N·∫øu n√≥i v·ªÅ t√†i nguy√™n, Production lu√¥n v∆∞·ª£t tr·ªôi h∆°n m√¥i tr∆∞·ªùng Test, R&amp;D, nh∆∞ng th·ª±c t·∫ø th√¨ c√°c d·ªãch v·ª• ch·∫°y tr√™n Test l·∫°i nhanh h∆°n ƒë·∫øn 10-20 l·∫ßn.
T√¥i nh·ªõ m√¨nh ƒë√£ m·ªü bi·ªÉu ƒë·ªì Querry latency tr√™n ELK v√† ƒë·ª©ng h√¨nh m·ªôt l√∫c. M·∫•y c√°i th√¥ng s·ªë x·ª≠ l√Ω nh∆∞ th·ªÉ b·ªã k√©o d√†i m·ªôt c√°ch v√¥ l√Ω: m·ªôt request ƒë∆°n gi·∫£n v√†o d·ªãch v·ª• spell correction v·ªõi input ch·ªâ r·∫•t ng·∫Øn m√† l·∫°i m·∫•t t·ªõi 4.2 gi√¢y ƒë·ªÉ x·ª≠ l√Ω. V·ªõi ch√∫t √≠t kinh nghi·ªám, v√† m·ªôt ch√∫t linh c·∫£m trong ƒë·∫ßu t√¥i bi·∫øt ƒë√¢y kh√¥ng ch·ªâ l√† v·∫•n ƒë·ªÅ t√†i nguy√™n, m√† l√† m·ªôt c√¢u ƒë·ªë ph·ª©c t·∫°p h∆°n ƒëang ch·ªù ƒë·ª£i m√¨nh.</p>
<p><em>N√≥i qua s∆° b·ªô th√¨ d·ªãch v·ª• n√†y l√† ƒë·ªÉ ki·ªÉm tra ch√≠nh t·∫£ cho 1 ƒëo·∫°n vƒÉn b·∫£n, request s·∫Ω ch·ª©a sentences ƒëi v√†o Model AI x·ª≠ l√Ω v√† response s·∫Ω tr·∫£ l·∫°i xem l·ªói ch√≠nh t·∫£ ·ªü ƒë√¢u, s·ª≠a th·∫ø n√†o!</em></p>
<p><strong>B·∫°n c√≥ th·ªÉ t∆∞·ªüng t∆∞·ª£ng d·ªãch v·ª• ch·∫≠m nh∆∞ th·∫ø n√†o qua ·∫£nh n√†y:</strong>
<img loading="lazy" src="/sre-tracing-slow-service-img/Pasted_image_20250112015156.png" alt="Pasted image 20250112015156.png"  />
</p>
<hr>
<h3 id="ph√¢n-t√≠ch-v·∫•n-ƒë·ªÅ">Ph√¢n t√≠ch v·∫•n ƒë·ªÅ<a hidden class="anchor" aria-hidden="true" href="#ph√¢n-t√≠ch-v·∫•n-ƒë·ªÅ">#</a></h3>
<p>Khi ƒë·ªëi m·∫∑t v·ªõi s·ª± c·ªë hi·ªáu su·∫•t, ta ph·∫£i c√≥ m·ªôt s·ªë gi·∫£ thi·∫øt v·ªÅ n√≥, vi·ªác ƒë·∫ßu ti√™n l√† chia nh·ªè h·ªá th·ªëng th√†nh t·ª´ng ph·∫ßn r√µ r√†ng. V·ªõi t√¥i, m·ªôt request s·∫Ω ph·∫£i qua r·∫•t nhi·ªÅu l·ªõp ƒë·ªÉ c√≥ th·ªÉ ƒëi ƒë·∫øn ƒë∆∞·ª£c d·ªãch v·ª• b√™n d∆∞·ªõi c·ªßa d·ª± √°n, v√† t√¥i s·∫Ω chia n√≥ th√†nh ba l·ªõp ch√≠nh:</p>
<ol>
<li><strong>L·ªõp ƒëi·ªÅu h∆∞·ªõng request</strong>: T·ª´ Domain, Firewall, Load Balancer, Ingress ƒë·∫øn Endpoint.</li>
<li><strong>L·ªõp x·ª≠ l√Ω logic</strong>: C√°c container, pod, v√† lu·ªìng logic trong ·ª©ng d·ª•ng.</li>
<li><strong>L·ªõp l∆∞u tr·ªØ</strong>: Database, file storage, ho·∫∑c c√°c config li√™n quan.</li>
</ol>
<p>S·ª± ch·∫≠m tr·ªÖ c√≥ th·ªÉ xu·∫•t ph√°t t·ª´ m·ªôt ho·∫∑c nhi·ªÅu th√†nh ph·∫ßn trong c√°c l·ªõp n√†y. V√¨ v·∫≠y, b∆∞·ªõc ti·∫øp theo l√† ti·∫øn h√†nh ki·ªÉm tra t·ª´ng l·ªõp, ph√¢n t√≠ch v√† lo·∫°i suy ƒë·ªÉ x√°c ƒë·ªãnh th√†nh ph·∫ßn n√†o ho·∫°t ƒë·ªông ·ªïn ƒë·ªãnh v√† nhanh ch√≥ng, v√† th√†nh ph·∫ßn n√†o g·∫∑p v·∫•n ƒë·ªÅ ho·∫∑c b·ªã ch·∫≠m.</p>
<hr>
<h3 id="lo·∫°i-suy-ƒëi·ªÅu-h∆∞·ªõng-request">Lo·∫°i suy: ƒêi·ªÅu h∆∞·ªõng request<a hidden class="anchor" aria-hidden="true" href="#lo·∫°i-suy-ƒëi·ªÅu-h∆∞·ªõng-request">#</a></h3>
<p>C√¥ng c·ª• ƒë·∫ßu ti√™n t√¥i d√πng l√† <code>curl</code>, m·ªôt c√¥ng c·ª• trung th√†nh v√† quen thu·ªôc c·ªßa m·ªçi SRE. T√¥i vi·∫øt m·ªôt l·ªánh curl c√≥ th·ªÉ ƒëo th·ªùi gian cho t·ª´ng b∆∞·ªõc: t·ª´ ph√¢n gi·∫£i DNS ƒë·∫øn k·∫øt n·ªëi server, t·ª´ b·∫Øt ƒë·∫ßu truy·ªÅn t·∫£i ƒë·∫øn khi ho√†n t·∫•t. C·∫•u h√¨nh nh∆∞ sau:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>curl -w <span style="color:#e6db74">&#34;@curltime&#34;</span> -X <span style="color:#e6db74">&#39;POST&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#e6db74">&#39;https://aiservice.xxx.xx/api/v1/correction-spell?use_g=false&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -H <span style="color:#e6db74">&#39;accept: application/json&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -H <span style="color:#e6db74">&#39;Content-Type: application/json&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -d <span style="color:#e6db74">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;sentences&#34;: &#34;ƒê·ªëi v·ªõi t√†u qu√¢n s·ª±...&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;num_suggestions&#34;: 3,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;beam_width&#34;: 5,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;boas&#34;: true,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;eosa&#34;: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }&#39;</span>
</span></span></code></pre></div><p>File <code>curltime</code> ƒë·ªÉ ƒëo t·ª´ng th√¥ng s·ªë:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>     time_namelookup:  %<span style="color:#f92672">{</span>time_namelookup<span style="color:#f92672">}</span>s<span style="color:#ae81ff">\n</span>
</span></span><span style="display:flex;"><span>        time_connect:  %<span style="color:#f92672">{</span>time_connect<span style="color:#f92672">}</span>s<span style="color:#ae81ff">\n</span>
</span></span><span style="display:flex;"><span>     time_appconnect:  %<span style="color:#f92672">{</span>time_appconnect<span style="color:#f92672">}</span>s<span style="color:#ae81ff">\n</span>
</span></span><span style="display:flex;"><span>    time_pretransfer:  %<span style="color:#f92672">{</span>time_pretransfer<span style="color:#f92672">}</span>s<span style="color:#ae81ff">\n</span>
</span></span><span style="display:flex;"><span>       time_redirect:  %<span style="color:#f92672">{</span>time_redirect<span style="color:#f92672">}</span>s<span style="color:#ae81ff">\n</span>
</span></span><span style="display:flex;"><span>  time_starttransfer:  %<span style="color:#f92672">{</span>time_starttransfer<span style="color:#f92672">}</span>s<span style="color:#ae81ff">\n</span>
</span></span><span style="display:flex;"><span>                     ----------<span style="color:#ae81ff">\n</span>
</span></span><span style="display:flex;"><span>          time_total:  %<span style="color:#f92672">{</span>time_total<span style="color:#f92672">}</span>s<span style="color:#ae81ff">\n</span>
</span></span></code></pre></div><p>Qua nhi·ªÅu th·ª≠ nghi·ªám, t·ª´ m·∫°ng n·ªôi b·ªô c√¥ng ty ƒë·∫øn m·∫°ng b√™n ngo√†i, thay ƒë·ªïi c·∫£ domain trong file hosts ƒë·ªÉ test ingress, t√¥i nh·∫≠n ra request ƒë∆∞·ª£c chuy·ªÉn ƒë·∫øn d·ªãch v·ª• Uvicorn (ASGI server c·ªßa d·ª± √°n) r·∫•t nhanh. ƒêi·ªÅu n√†y lo·∫°i b·ªè kh·∫£ nƒÉng v·∫•n ƒë·ªÅ n·∫±m ·ªü t·∫ßng ƒëi·ªÅu h∆∞·ªõng. Lo·∫°i suy ƒë∆∞·ª£c m·ªôt th√†nh ph·∫ßn l·ªõn. Ti·∫øp theo, t√¥i  s·∫Ω t·∫≠p trung v√†o l·ªõp x·ª≠ l√Ω logic.</p>
<hr>
<h3 id="l·ªõp-x·ª≠-l√Ω-logic">L·ªõp x·ª≠ l√Ω logic<a hidden class="anchor" aria-hidden="true" href="#l·ªõp-x·ª≠-l√Ω-logic">#</a></h3>
<p>Khi x·ª≠ l√Ω logic ta c≈©ng s·∫Ω c√≥ m·ªôt s·ªë nguy√™n nh√¢n d·∫´n ƒë·∫øn vi·ªác ch·∫≠m tr·ªÖ, m·ªôt s·ªë l√Ω do c√≥ th·ªÉ k·ªÉ ƒë·∫øn nh∆∞: Thi·∫øu resource v·ªÅ RAM, thi·∫øu CPU, vi·ªác ƒë·ªçc ghi I/O disk b√™n d∆∞·ªõi b·ªã ch·∫≠m, x·ª≠ l√Ω logic code c√≥ v·∫•n ƒë·ªÅ (CodeSmell, v√≤ng l·∫∑p x·ª≠ l√Ω qu√° t·∫£i, Recursive function,&hellip;) . Vi·ªác c·∫•p ph√°t t√†i nguy√™n m√°y ch·ªß tr√™n c√°c m√¥i tr∆∞·ªùng Test v√† Production t∆∞∆°ng ƒë·ªëi gi·ªëng nhau, ƒë·ªÅu s·ª≠ d·ª•ng Ubuntu 20.04 v√† c√°c th√†nh ph·∫ßn setting trong kernel nh∆∞ sysctl.conf c≈©ng kh√¥ng kh√°c bi·ªát.</p>
<p>T√¥i chuy·ªÉn sang ki·ªÉm tra l·∫ßn l∆∞·ª£t c√°c nguy√™n nh√¢n ti·ªÅm ·∫©n trong khi logic x·ª≠ l√Ω:</p>
<ul>
<li>Thi·∫øu t√†i nguy√™n (RAM, CPU).</li>
<li>I/O disk ch·∫≠m.</li>
<li>V·∫•n ƒë·ªÅ trong code logic (v√≤ng l·∫∑p qu√° t·∫£i, ƒë·ªá quy&hellip;).</li>
</ul>
<p>B·∫•t ng·ªù thay, t√†i nguy√™n h·ªá th·ªëng d∆∞·ªùng nh∆∞ d∆∞ d·∫£:</p>
<ul>
<li>CPU tr√™n node worker ch·ªâ ch·∫°m ng∆∞·ª°ng 40-50%.</li>
<li>RAM c≈©ng ch·ªâ s·ª≠ d·ª•ng kho·∫£ng 70-80%.</li>
<li>C√°c d·ªãch v·ª• c·ªßa d·ª± √°n AI ƒë√£ ƒë∆∞·ª£c t√°ch ra c√°c node worker ri√™ng.</li>
</ul>
<p>Khi ƒë·ªëi di·ªán v·ªõi c√°c th√†nh ph·∫ßn ch·∫≠m treo trong h·ªá th·ªëng, ta th∆∞·ªùng c√≥ xu h∆∞·ªõng nghƒ© ngay ƒë·∫øn vi·ªác tƒÉng t√†i nguy√™n cho Container, POD, ƒë√¢y l√† m·ªôt gi·∫£i ph√°p nhanh ch√≥ng ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ. ƒê·∫∑c bi·ªát, trong tr∆∞·ªùng h·ª£p n√†y, c√°c d·ªãch v·ª• AI c≈©ng kh√¥ng n·∫±m ngo√†i xu h∆∞·ªõng ƒë√≥. T√†i nguy√™n c·ªßa POD ƒë√£ ƒë∆∞·ª£c tƒÉng g·∫•p ƒë√¥i, th·∫≠m ch√≠ g·∫•p ba. Nh∆∞ng ngay c·∫£ sau khi √°p d·ª•ng thay ƒë·ªïi n√†y, v·∫•n ƒë·ªÅ v·∫´n kh√¥ng ƒë∆∞·ª£c gi·∫£i quy·∫øt. Tuy nhi√™n, qua qu√° tr√¨nh n√†y, t√¥i c≈©ng thu th·∫≠p ƒë∆∞·ª£c m·ªôt s·ªë th√¥ng tin quan tr·ªçng, gi√∫p t√¥i c√≥ nhi·ªÅu insight h∆°n v·ªÅ nguy√™n nh√¢n g·ªëc r·ªÖ c·ªßa s·ª± c·ªë.</p>
<p><strong>Th√¥ng tin thu th·∫≠p ƒë∆∞·ª£c t·ª´ h·ªá th·ªëng:</strong></p>
<ol>
<li><strong>Pod kh√¥ng ƒë·∫°t ng∆∞·ª°ng limit c·ªßa container</strong></li>
<li><strong>D·ªãch v·ª• Uvicorn:</strong>
<ul>
<li>D·ªãch v·ª• nh·∫≠n request nhanh v√† m∆∞·ª£t tr√™n t·∫•t c·∫£ c√°c node.</li>
</ul>
</li>
</ol>
<p>L√∫c n√†y, t√¥i b·∫Øt ƒë·∫ßu nghi ng·ªù r·∫±ng c√≥ m·ªôt y·∫øu t·ªë kh√°c ƒëang can thi·ªáp, ƒë·∫∑c bi·ªát l√† khi m√¥i tr∆∞·ªùng Production c√≥ nhi·ªÅu d·ªãch v·ª• ch·∫°y song song, trong khi m√¥i tr∆∞·ªùng test ch·ªâ c√≥ m·ªôt v√†i service c∆° b·∫£n. L√Ω do t√¥i nghi ng·ªù l√† v√¨ tr√™n Prod c√≥ th√™m 1 d·ªãch v·ª• Captcha ƒë∆∞·ª£c l·∫≠p l·ªãch ƒë·ª©ng c√πng, d·ªãch v·ª• n√†y s·ª≠ d·ª•ng model AI ƒë·ªÉ x·ª≠ l√Ω h√¨nh ·∫£nh. Ch√≠nh v√¨ v·∫≠y, t√¥i quy·∫øt ƒë·ªãnh th·ª≠ m·ªôt s·ªë test case ƒë·ªÉ l√†m r√µ c√°c y·∫øu t·ªë c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn hi·ªáu su·∫•t. Trong qu√° tr√¨nh n√†y, k·∫øt h·ª£p th√™m vi·ªác s·ª≠ d·ª•ng c√°c c√¥ng c·ª• v√† c√¢u l·ªánh ƒë·ªÉ ƒëo ƒë·∫°c t√†i nguy√™n c·ªßa h·ªá th·ªëng, ƒë·∫∑c bi·ªát l√† CPU, RAM v√† I/O Disk.</p>
<p><strong>Brief v·ªÅ c√°c c√¥ng c·ª• v√† c√¢u l·ªánh ƒë∆∞·ª£c d√πng:</strong></p>
<ol>
<li>
<p>L·ªánh <code>mpstat</code> l√† m·ªôt l·ªánh trong Linux d√πng ƒë·ªÉ b√°o c√°o v·ªÅ hi·ªáu su·∫•t CPU. C·ª• th·ªÉ s·ª≠ d·ª•ng l·ªánh <code>mpstat -P ALL 1</code> s·∫Ω hi·ªÉn th·ªã th·ªëng k√™ CPU cho t·∫•t c·∫£ c√°c b·ªô x·ª≠ l√Ω v·ªõi t·∫ßn su·∫•t m·ªôt gi√¢y. Ta c√≥ th·ªÉ ƒë·ªÉ √Ω m·ªôt s·ªë metrics:</p>
<ul>
<li>H·ªá th·ªëng b√¨nh th∆∞·ªùng n·∫øu:
<code>%usr</code> , <code>%sys</code> v√† <code>%idle</code> c√≥ gi√° tr·ªã h·ª£p l√Ω, kh√¥ng qu√° cao ho·∫∑c qu√° th·∫•p.
<code>%idle</code> cao (v√≠ d·ª•: 80-90%) nghƒ©a l√† CPU ƒëang nh√†n r·ªói nhi·ªÅu, kh√¥ng b·ªã t·∫£i cao.
<code>%usr</code> v√† <code>%sys</code> kh√¥ng qu√° cao (d∆∞·ªõi 50%) cho th·∫•y kh√¥ng c√≥ nhi·ªÅu t√°c v·ª• user v√† h·ªá th·ªëng ƒëang ch·∫°y.</li>
<li>H·ªá th·ªëng c√≥ v·∫•n ƒë·ªÅ khi:
<code>%iowait</code> cao (tr√™n 5%) cho th·∫•y h·ªá th·ªëng ƒëang ch·ªù I/O nhi·ªÅu, c√≥ th·ªÉ do ƒëƒ©a c·ª©ng ch·∫≠m ho·∫∑c v·∫•n ƒë·ªÅ m·∫°ng.
<code>%steal</code> cao c√≥ th·ªÉ cho th·∫•y v·∫•n ƒë·ªÅ v·ªÅ ·∫£o h√≥a, CPU b·ªã steal b·ªüi hypervisor.
<code>%usr</code> ho·∫∑c <code>%sys</code> qu√° cao (tr√™n 70-80%) cho th·∫•y CPU ƒëang b·ªã t·∫£i cao, c√≥ th·ªÉ g√¢y ra hi·ªáu su·∫•t k√©m.</li>
</ul>
</li>
<li>
<p>L·ªánh <code>vmstat</code> (Virtual Memory Statistics) trong Linux cung c·∫•p th√¥ng tin v·ªÅ h·ªá th·ªëng b·ªô nh·ªõ, swap, I/O, v√† CPU. Khi ch·∫°y <code>vmstat 1</code>, h·ªá th·ªëng s·∫Ω b√°o c√°o c√°c th·ªëng k√™ n√†y m·ªói gi√¢y.</p>
</li>
<li>
<p>L·ªánh <code>iostat -x 1</code> trong Linux cung c·∫•p th√¥ng tin v·ªÅ ho·∫°t ƒë·ªông c·ªßa c√°c thi·∫øt b·ªã l∆∞u tr·ªØ (disk) nh∆∞ t·ªëc ƒë·ªô ƒë·ªçc/ghi, ƒë·ªô ch·∫≠m (latency), v√† t√¨nh tr·∫°ng s·ª≠ d·ª•ng CPU. M·ªôt v√†i th√¥ng s·ªë ta c·∫ßn ƒë·ªÉ √Ω nh∆∞:
<strong>%util cao</strong>: C√°c thi·∫øt b·ªã l∆∞u tr·ªØ c√≥ %util cao cho th·∫•y ch√∫ng ƒëang g·∫∑p ph·∫£i v·∫•n ƒë·ªÅ t·∫£i.
<strong>Th·ªùi gian ch·ªù I/O cao</strong>: CPU ƒëang ph·∫£i ch·ªù ƒë·ª£i nhi·ªÅu ƒë·ªÉ x·ª≠ l√Ω I/O.
<strong>T·ªëc ƒë·ªô x·ª≠ l√Ω I/O ch·∫≠m</strong>: <code>await</code> v√† <code>svctm</code> c√≥ gi√° tr·ªã cao, cho th·∫•y th·ªùi gian ch·ªù v√† th·ªùi gian d·ªãch v·ª• cho c√°c y√™u c·∫ßu I/O ƒë·ªÅu cao.</p>
</li>
</ol>
<p><strong>K·∫øt qu·∫£ t·ª´ c√°c th·ª≠ nghi·ªám:</strong></p>
<ul>
<li>
<p><strong>Case 1:</strong> Service Spell Correction ch·∫°y m·ªôt m√¨nh tr√™n node (kh√¥ng c√≥ service captcha).<br>
<strong>K·∫øt qu·∫£:</strong> D·ªãch v·ª• ch·∫°y m∆∞·ª£t m√†, th·ªùi gian x·ª≠ l√Ω nhanh ch√≥ng.</p>
</li>
<li>
<p><strong>Case 2:</strong> Service Spell Correction ch·∫°y c√πng 1-2 pod service captcha.<br>
<strong>K·∫øt qu·∫£:</strong> Th·ªùi gian x·ª≠ l√Ω tƒÉng t·ª´ 1s l√™n 2.5s.</p>
</li>
<li>
<p><strong>Case 3:</strong> Service Spell Correction ch·∫°y c√πng 4-5 pod service captcha.<br>
<strong>K·∫øt qu·∫£:</strong> Th·ªùi gian x·ª≠ l√Ω tƒÉng l√™n ƒë√°ng k·ªÉ, t·ª´ 2.5s l√™n 9-10s.</p>
</li>
<li>
<p><strong>Case 4:</strong> Sau khi x√≥a h·∫øt pod captcha tr√™n node worker (WK).<br>
<strong>K·∫øt qu·∫£:</strong> Th·ªùi gian x·ª≠ l√Ω gi·∫£m nhanh ch√≥ng, tr·ªü l·∫°i m·ª©c b√¨nh th∆∞·ªùng 1-2s.</p>
</li>
<li>
<p><strong>Case 5:</strong> Scale pod l√™n 5 tr√™n worker.<br>
<strong>K·∫øt qu·∫£:</strong> Service Spell Correction x·ª≠ l√Ω nhanh v√† ·ªïn ƒë·ªãnh, ch·ªâ m·∫•t kho·∫£ng 0.5-1.5s, khi kh√¥ng c√≥ service captcha tr√™n worker.</p>
</li>
<li>
<p><strong>Case 6:</strong> ƒê∆∞a pod Spell Correction sang node worker kh√°c, kh√¥ng cho pod c·ªßa captcha schedule tr√™n ƒë√≥.<br>
<strong>K·∫øt qu·∫£:</strong> M·∫∑c d√π d·ªãch v·ª• Spell Correction ch·∫°y tr√™n worker m·ªõi, th·ªùi gian x·ª≠ l√Ω v·∫´n ch·∫≠m (9s), cho th·∫•y c√≥ s·ª± can thi·ªáp t·ª´ c√°c d·ªãch v·ª• AI kh√°c ƒëang ch·∫°y tr√™n worker.</p>
</li>
</ul>
<p><strong>ƒêi·ªÅu ch·ªânh t√†i nguy√™n:</strong></p>
<p>T√¥i th·ª≠ thay ƒë·ªïi t·ª´ Bustable sang QOS Guaranteed, v·ªõi request = limit v√† kh√¥ng ƒë·∫∑t limit t√†i nguy√™n, nh∆∞ng kh√¥ng c√≥ s·ª± thay ƒë·ªïi v·ªÅ hi·ªáu su·∫•t. C√°c d·ªãch v·ª• v·∫´n x·ª≠ l√Ω ch·∫≠m nh∆∞ c≈©.</p>
<hr>
<h3 id="tracing-v√†-profiling">Tracing v√† Profiling:<a hidden class="anchor" aria-hidden="true" href="#tracing-v√†-profiling">#</a></h3>
<p>Khi d√πng Py-spy v√† l·ªánh <code>perf record -F 99 -a -g -- sleep 10</code> cho code python c·ªßa d·ªãch v·ª• AI , t√¥i ph√°t hi·ªán r·∫±ng th∆∞ vi·ªán <code>Libgomp-a34b3233.so</code> c·ªßa PyTorch chi·∫øm nhi·ªÅu th·ªùi gian x·ª≠ l√Ω. ƒê√¢y l√† th∆∞ vi·ªán cho ph√©p th·ª±c thi song song tr√™n nhi·ªÅu l√µi CPU, v√† r√µ r√†ng CPU ƒëang g·∫∑p v·∫•n ƒë·ªÅ khi x·ª≠ l√Ω l∆∞·ª£ng l·ªõn ph√©p to√°n song song. L√∫c n√†y, t√¥i c√≥ th·ªÉ suy lu·∫≠n r·∫±ng v·∫•n ƒë·ªÅ ch·ªß y·∫øu n·∫±m ·ªü ph·∫ßn x·ª≠ l√Ω CPU, ch·ª© kh√¥ng ph·∫£i ·ªü t√†i nguy√™n h·ªá th·ªëng kh√°c.
H∆°i ti·∫øc l√† kh√¥ng c√≤n ·∫£nh n√†o ch·ª•p l·∫°i ƒë·ªÉ show ra ƒë√¢y (Ôø£„Å∏Ôø£)</p>
<h3 id="ki·ªÉm-tra-t·ª´-b√™n-trong-container-pod">Ki·ªÉm tra t·ª´ b√™n trong container pod:<a hidden class="anchor" aria-hidden="true" href="#ki·ªÉm-tra-t·ª´-b√™n-trong-container-pod">#</a></h3>
<p>Ti·∫øn h√†nh ki·ªÉm tra t·ª´ b√™n trong container qua c√¢u l·ªánh <code>kubectl exec -it</code> ƒë·ªÉ x√°c nh·∫≠n t√¨nh tr·∫°ng t√†i nguy√™n. C√°c th√¥ng s·ªë nh∆∞ <code>nr_periods</code>, <code>nr_throttled</code> v√† <code>throttled_time</code> cao trong <strong>/sys/fs/cgroup/cpu/cpu.stat</strong> cho th·∫•y pod b·ªã gi·ªõi h·∫°n m·ª©c x·ª≠ l√Ω CPU, ƒë√¢y ch√≠nh l√† nguy√™n nh√¢n l√†m ch·∫≠m tr·ªÖ qu√° tr√¨nh x·ª≠ l√Ω.</p>
<h3 id="confirm-b·∫±ng-stress-test">Confirm b·∫±ng Stress test:<a hidden class="anchor" aria-hidden="true" href="#confirm-b·∫±ng-stress-test">#</a></h3>
<p>Cu·ªëi c√πng, t√¥i quy·∫øt ƒë·ªãnh th·ª±c hi·ªán m·ªôt stress test ƒë·ªÉ confirm l·∫°i gi·∫£ thi·∫øt v·ªõi c√¢u l·ªánh <code>stress-ng --cpu 2 --cpu-method int32 --timeout 240s --verbose --metrics-brief</code>, th·ª≠ nghi·ªám n√†y gi√∫p m√¥ ph·ªèng t√°c v·ª• t√≠nh to√°n n·∫∑ng m√† AI model c·∫ßn ph·∫£i x·ª≠ l√Ω. L·ªánh n√†y ƒë·ªÉ Stress test t√†i nguy√™n t√≠nh to√°n CPU b·∫±ng c√°c ph√©p to√°n s·ªë nguy√™n 32bit. T·∫°i sao l·∫°i ch·ªçn l·ªánh t√≠nh to√°n n√†y, ng·∫Øn g·ªçn l√† b·ªüi v√¨ Model AI s·ª≠ d·ª•ng r·∫•t nhi·ªÅu c√°c t√≠nh to√°n ma tr·∫≠n. Trong c√°c tr∆∞·ªùng h·ª£p kh√°c ta c√≥ th·ªÉ s·ª≠ d·ª•ng ph√©p to√°n kh√°c. K·∫øt qu·∫£ l√† khi CPU b·ªã d·ªìn v√†o x·ª≠ l√Ω c√πng l√∫c, th·ªùi gian x·ª≠ l√Ω tƒÉng v·ªçt, v√† m·∫∑c d√π worker node v·∫´n c√≤n nhi·ªÅu core CPU, d·ªãch v·ª• AI l·∫°i s·ª≠ d·ª•ng nhi·ªÅu CPU h∆°n (t·ª´ 600m CPU l√™n 1500m, khi c√≥ t√≠nh to√°n c√πng l√∫c th√¨ l√™n ƒë·∫øn 2k-5k CPU n·∫øu kh√¥ng ƒë·∫∑t limit).</p>
<p>ƒê√£ c√≥ th·ªÉ k·∫øt lu·∫≠n l√† vi·ªác &ldquo;<strong>s·ª≠ d·ª•ng nhi·ªÅu t√†i nguy√™n CPU t√≠nh to√°n c√πng l√∫c</strong>&rdquo; ch√≠nh l√† nguy√™n nh√¢n ch√≠nh g√¢y ra s·ª± ch·∫≠m tr·ªÖ. D√π ƒë√£ ¬†<strong>Isolate t√†i nguy√™n CPU</strong> gi·ªØa c√°c d·ªãch v·ª•, v·∫•n ƒë·ªÅ v·∫´n kh√¥ng ƒë∆∞·ª£c gi·∫£i quy·∫øt tri·ªát ƒë·ªÉ. Tuy nhi√™n, trong kho·∫£ng th·ªùi gian ch∆∞a t√¨m ra workaround t√¥i nh·∫≠n th·∫•y r·∫±ng khi t√°ch ri√™ng d·ªãch v·ª• ho·∫∑c s·ª≠ d·ª•ng GPU Container, h·ªá th·ªëng c√≥ th·ªÉ ho·∫°t ƒë·ªông ·ªïn ƒë·ªãnh h∆°n.</p>
<hr>
<h3 id="research-ƒë·ªÉ-x·ª≠-l√Ω-v·∫•n-ƒë·ªÅ">Research ƒë·ªÉ x·ª≠ l√Ω v·∫•n ƒë·ªÅ:<a hidden class="anchor" aria-hidden="true" href="#research-ƒë·ªÉ-x·ª≠-l√Ω-v·∫•n-ƒë·ªÅ">#</a></h3>
<p>V√¨ mu·ªën ƒë√†o s√¢u h∆°n v·∫•n ƒë·ªÅ ƒë·ªÉ gi·∫£i quy·∫øt tri·ªát ƒë·ªÉ, t√¥i ƒë√£ ng·ªìi ƒë·ªçc l·∫°i c√°c t√†i li·ªáu v·ªÅ ContainerD, Cgroups. Cgroups l√† m·ªôt t√≠nh nƒÉng c·ªßa Kernel Linux nh·∫±m c·∫•p ph√°t gi·ªõi h·∫°n, t√≠nh to√°n v√† t√°ch bi·ªát vi·ªác s·ª≠ d·ª•ng t√†i nguy√™n c·ªßa m·ªôt t·∫≠p h·ª£p c√°c process. Containerd s·ª≠ d·ª•ng t√†i nguy√™n n√†y ƒë·ªÉ kh·ªüi t·∫°o c√°c pod container. N·∫øu m·ªçi ng∆∞·ªùi th·∫Øc m·∫Øc t·∫°i sao l·∫°i l√† containerd v√† cgroups c√≥ th·ªÉ xem b·ª©c ·∫£nh n√†y:</p>
<p><img loading="lazy" src="/sre-tracing-slow-service-img/Pasted_image_20250112023030.png" alt="Pasted image 20250112023030.png"  />
</p>
<p>Cgroups v√† CPU khi ph√¢n t√°ch CPU trong K8S ch·ªãu s·ª± qu·∫£n l√Ω c·ªßa Linux Kernel, m·∫∑c ƒë·ªãnh s·∫Ω s·ª≠ d·ª•ng c∆° ch·∫ø Completely Fair Scheduler (CFS) quota. [https://docs.kernel.org/scheduler/sched-design-CFS.html]. CFS ch·ªãu tr√°ch nhi·ªám ph√¢n chia th·ªùi gian CPU m·ªôt c√°ch c√¥ng b·∫±ng gi·ªØa c√°c process. ƒê·∫£m b·∫£o r·∫±ng kh√¥ng c√≥ process n√†o b·ªã b·ªè qua ho·∫∑c b·ªã ∆∞u ti√™n qu√° m·ª©c. Ch√≠nh v√¨ l√Ω do n√†y c√°c process s·ª≠ d·ª•ng nhi·ªÅu CPU c√≥ th·ªÉ ƒë∆∞a c√°c workload c·ªßa m√¨nh sang c√°c core CPU kh√°c.</p>
<p>V·∫≠y th√¨ c√≥ c√°ch n√†o ƒë·ªÉ Isolate CPU cho m·ªôt ti·∫øn tr√¨nh ho·∫∑c m·ªôt container tr√™n linux kh√¥ng? C√≥ , trong cgroups v1 m·ªôt c∆° ch·∫ø l√† Cpuset. CPUSet t·∫≠p trung v√†o vi·ªác gi·ªõi h·∫°n v√† ki·ªÉm so√°t c√°c ti·∫øn tr√¨nh ƒë·ªÉ ch·∫°y tr√™n c√°c CPU c·ª• th·ªÉ, gi√∫p qu·∫£n l√Ω t√†i nguy√™n, isolate CPU t·ªët h∆°n.
Sau khi research 2 c∆° ch·∫ø tr√™n, ta c√≥ th·ªÉ t√¨m th·∫•y cpuset trong m√£ ngu·ªìn c·ªßa kubelet. Nh∆∞ng c∆° ch·∫ø n√†y kh√¥ng ƒë∆∞·ª£c m·∫∑c ƒë·ªãnh b·∫≠t m√† ph·∫£i c√≥ flag <code>cpu-manager-policy=static</code>.</p>
<p><img loading="lazy" src="/sre-tracing-slow-service-img/Pasted_image_20250112023127.png" alt="Pasted image 20250112023127.png"  />
</p>
<p>M·∫∑c ƒë·ªãnh kubelet s·∫Ω s·ª≠ d·ª•ng policy None:  <code>kubelet/cm/cpumanager/policy_none.go</code> , sau khi set <code>static</code> kubelet s·∫Ω b·∫Øt ƒë·∫ßu s·ª≠ d·ª•ng <code>pkg/kubelet/cm/cpumanager/policy_static.go</code> v√† c√≥ v·∫ª ƒë√¢y ƒë√∫ng l√† th·ª© m√† ch√∫ng ta c·∫ßn.</p>
<p><img loading="lazy" src="/sre-tracing-slow-service-img/Pasted_image_20250112023204.png" alt="Pasted image 20250112023204.png"  />
</p>
<p>Sau khi config static flag cho kubelet. ƒê∆∞a d·ªãch v·ª• v·ªÅ <code>QoS Class Guaranteed</code> t·ª©c Limit b·∫±ng v·ªõi Request, d·ªãch v·ª• ƒë√£ ho·∫°t ƒë·ªông ·ªïn ƒë·ªãnh v·ªõi ƒë√∫ng l∆∞·ª£ng t√†i nguy√™n t√≠nh to√°n c·ªßa CPU ƒë∆∞·ª£c c·∫•p ri√™ng. T√†i nguy√™n t√≠nh to√°n c·ªßa d·ªãch v·ª• ƒë∆∞·ª£c Isolate m·ªôt c√°ch tri·ªát ƒë·ªÉ v√† kh√¥ng c√≤n b·ªã ·∫£nh h∆∞·ªüng b·ªüi c√°c t√≠nh to√°n c·ªßa c√°c service POD kh√°c trong Node. Service AI ch·∫°y nhanh tr·ªü l·∫°i v√† kh√¥ng t·ªën t√†i nguy√™n CPU nh∆∞ tr∆∞·ªõc do kh√¥ng c√≥ t√†i nguy√™n n√†o ƒë∆∞·ª£c l·∫≠p l·ªãch v√†o nh·ªØng Core CPU ƒë∆∞·ª£c c·∫•p cho ri√™ng d·ªãch v·ª• AI. Th·ªùi gian x·ª≠ l√Ω t·ª´ 7-10s gi·∫£m xu·ªëng c√≤n 0.5 -1s.</p>
<p><img loading="lazy" src="/sre-tracing-slow-service-img/Pasted_image_20250112023302.png" alt="Pasted image 20250112023302.png"  />
</p>
<p>V·ªÅ ph·∫ßn QoS b·∫°n c√≥ th·ªÉ ƒë·ªçc ·ªü ƒë√¢y:
[https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/]</p>
<p><img loading="lazy" src="/sre-tracing-slow-service-img/Pasted_image_20250112023336.png" alt="Pasted image 20250112023336.png"  />
</p>
<hr>
<h3 id="t√≥m-l·∫°i-th√¨">T√≥m l·∫°i th√¨:<a hidden class="anchor" aria-hidden="true" href="#t√≥m-l·∫°i-th√¨">#</a></h3>
<ul>
<li>D·ªãch v·ª• (POD, Container) AI x·ª≠ l√Ω ch·∫≠m khi c√≥ nhi·ªÅu t√†i nguy√™n t√≠nh to√°n CPU ch·∫°y ƒë·ªìng th·ªùi tr√™n m·ªôt Node.</li>
<li>M·∫∑c ƒë·ªãnh kubelet k8s kh√¥ng s·ª≠ d·ª•ng vi·ªác  ph√¢n t√°ch t√†i nguy√™n CPU t·ª´ng core ri√™ng bi·ªát m√† ph·∫£i s·ª≠ d·ª•ng flag <code>cpu-manager-policy=static</code>.</li>
<li>Ch·ªâ khi s·ª≠ d·ª•ng flag tr√™n, c√°c d·ªãch v·ª• s·ª≠ d·ª•ng <code>QoS Guaranteed</code> m·ªõi ƒë∆∞·ª£c ph√¢n t√°ch t√†i nguy√™n t√≠nh to√°n CPU m·ªôt c√°ch r√µ r√†ng v√† kh√¥ng b·ªã ·∫£nh h∆∞·ªüng b·ªüi c√°c d·ªãch v·ª• kh√°c. (L∆∞u √Ω, khi s·ª≠ d·ª•ng <code>BustAble</code> t·ª©c l√† l∆∞·ª£ng request nh·ªè h∆°n Limit container c≈©ng s·∫Ω kh√¥ng ƒë∆∞·ª£c ph√¢n t√°ch v√† ƒë·∫£m b·∫£o t√†i nguy√™n t√≠nh to√°n tr√™n m·ªçi policy ).</li>
<li>Sau khi ƒë∆∞·ª£c ph√¢n t√°ch t√†i nguy√™n t√≠nh to√°n, d·ªãch v·ª• s·∫Ω ho·∫°t ƒë·ªông nhanh v√† ·ªïn ƒë·ªãnh tr·ªü l·∫°i.</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="//localhost:1313/tags/k8s/">K8s</a></li>
      <li><a href="//localhost:1313/tags/containerd/">Containerd</a></li>
      <li><a href="//localhost:1313/tags/cgroups/">Cgroups</a></li>
      <li><a href="//localhost:1313/tags/tracing/">Tracing</a></li>
      <li><a href="//localhost:1313/tags/s%E1%BB%B1-c%E1%BB%91/">S·ª± C·ªë</a></li>
      <li><a href="//localhost:1313/tags/sre/">SRE</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="//localhost:1313/post/ignorant/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>Ignorant</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2025 <a href="//localhost:1313/">My 0x51 blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
